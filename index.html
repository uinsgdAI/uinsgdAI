<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>uinsgdAI - Asisten Belajar Humanis</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-green: #1a5d1a;
            --gold: #d4af37;
            --light-green: #f0f4f0;
            --user-bubble: #1a5d1a;
            --bg-color: #eef2ee;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            height: 100vh;
            display: flex; justify-content: center; align-items: center;
        }

        #chat-container {
            width: 100%; max-width: 480px; height: 92vh;
            background: white; border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            display: flex; flex-direction: column; overflow: hidden;
            border-top: 6px solid var(--gold);
        }

        header {
            background: var(--primary-green); color: white;
            padding: 18px; text-align: center;
        }

        header h1 { font-size: 1.3rem; letter-spacing: 1px; }
        header p { font-size: 0.75rem; opacity: 0.9; font-style: italic; margin-top: 3px; }

        #chat-window {
            flex: 1; overflow-y: auto; padding: 20px;
            display: flex; flex-direction: column; gap: 15px;
            background: #ffffff;
        }

        .message {
            max-width: 85%; padding: 12px 16px; border-radius: 15px;
            font-size: 0.95rem; line-height: 1.5;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }

        .bot {
            background: var(--light-green); color: #333;
            align-self: flex-start; border-bottom-left-radius: 2px;
            border-left: 4px solid var(--primary-green);
        }

        .user {
            background: var(--user-bubble); color: white;
            align-self: flex-end; border-bottom-right-radius: 2px;
        }

        .typing { font-size: 0.8rem; color: #888; padding: 5px 20px; display: none; font-style: italic; }

        #input-area { padding: 15px; background: white; border-top: 1px solid #eee; display: flex; gap: 10px; }

        input { flex: 1; padding: 12px 18px; border: 1px solid #ddd; border-radius: 25px; outline: none; font-size: 0.9rem; }
        input:focus { border-color: var(--primary-green); }

        button { 
            background: var(--primary-green); color: white; border: none; 
            padding: 0 22px; border-radius: 25px; cursor: pointer; 
            font-weight: 600; transition: 0.2s;
        }
        button:hover { background: #124012; }
        button:disabled { background: #ccc; }

        .error-box { background: #fee2e2; color: #b91c1c; font-size: 0.85rem; border: 1px solid #f87171; }
        
        #api-config {
            position: absolute; top: 10px; right: 10px;
            font-size: 0.7rem; color: var(--primary-green); cursor: pointer; text-decoration: underline;
        }
    </style>
</head>
<body>

<div id="api-config" onclick="resetKey()">Ganti API Key</div>

<div id="chat-container">
    <header>
        <h1>âœ¨ uinsgdAI âœ¨</h1>
        <p>Teman Belajar yang Sabar & Berakhlak</p>
    </header>

    <div id="chat-window">
        <div class="message bot">
            Assalamualaikum wr wb, Ananda Rifki ðŸ˜Š<br><br>
            Saya asisten belajar dari UIN Sunan Gunung Djati Bandung. Ada materi Matematika (Kombinatorika) atau hal lain yang ingin kita diskusikan hari ini?
        </div>
    </div>

    <div id="typing" class="typing">uinsgdAI sedang mengetik...</div>

    <div id="input-area">
        <input type="text" id="user-input" placeholder="Tuliskan pesan Ananda..." autocomplete="off">
        <button id="send-btn" onclick="sendMessage()">Kirim</button>
    </div>
</div>

<script>
    // --- KONFIGURASI API KEY ---
    // Agar tidak diblokir GitHub, kita simpan Key di browser (localStorage)
    let API_KEY = localStorage.getItem('GROQ_KEY');

    if (!API_KEY || API_KEY === 'null') {
        API_KEY = prompt("Selamat Datang di uinsgdAI!\n\nUntuk memulai, silakan masukkan API Key Groq Ananda (awalan gsk_...):");
        if (API_KEY) {
            localStorage.setItem('GROQ_KEY', API_KEY);
            alert("API Key berhasil disimpan di browser. Selamat belajar!");
        }
    }

    function resetKey() {
        localStorage.removeItem('GROQ_KEY');
        location.reload();
    }

    const chatWindow = document.getElementById('chat-window');
    const userInput = document.getElementById('user-input');
    const sendBtn = document.getElementById('send-btn');
    const typingLabel = document.getElementById('typing');

    async function sendMessage() {
        const text = userInput.value.trim();
        if (!text) return;
        if (!API_KEY) { alert("API Key belum diisi!"); resetKey(); return; }

        // Tampilkan pesan user
        appendMessage(text, 'user');
        userInput.value = '';
        setLoading(true);

        try {
            // Menggunakan Groq Cloud API (Super Cepat & Gratis)
            const response = await fetch("https://api.groq.com/openai/v1/chat/completions", {
                method: "POST",
                headers: {
                    "Authorization": `Bearer ${API_KEY}`,
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    model: "llama-3.1-8b-instant",
                    messages: [
                        {
                            role: "system",
                            content: `Kamu adalah uinsgdAI, asisten belajar dari UIN Sunan Gunung Djati Bandung. 
                            Karaktermu: Islami, humanis, dan sangat lembut (soft-spoken).
                            Gunakan sapaan 'Ananda'. Selalu buka dengan salam.
                            Jika user bertanya tentang Matematika atau Kombinatorika, jelaskan konsepnya dengan sangat sabar langkah demi langkah.
                            Tujuanmu adalah membuat user merasa nyaman dan betah belajar seperti dalam wawancara Ibu Guru yang ramah.`
                        },
                        { role: "user", content: text }
                    ],
                    temperature: 0.7
                })
            });

            const data = await response.json();

            if (!response.ok) {
                if(response.status === 401) throw new Error("API Key salah atau tidak valid.");
                throw new Error(data.error?.message || "Terjadi kesalahan pada server.");
            }

            const botReply = data.choices[0].message.content;
            appendMessage(botReply, 'bot');

        } catch (error) {
            console.error("Error:", error);
            appendMessage(`Mohon maaf Ananda, sepertinya ada kendala teknik (Error: ${error.message}).`, 'bot error-box');
        } finally {
            setLoading(false);
        }
    }

    function appendMessage(text, type) {
        const msgDiv = document.createElement('div');
        msgDiv.className = `message ${type}`;
        msgDiv.innerHTML = text.replace(/\n/g, '<br>');
        chatWindow.appendChild(msgDiv);
        chatWindow.scrollTop = chatWindow.scrollHeight;
    }

    function setLoading(isLoading) {
        typingLabel.style.display = isLoading ? 'block' : 'none';
        userInput.disabled = isLoading;
        sendBtn.disabled = isLoading;
        if (!isLoading) userInput.focus();
    }

    userInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') sendMessage(); });
</script>

</body>
</html>
